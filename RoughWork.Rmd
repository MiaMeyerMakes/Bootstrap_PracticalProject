---
title: "Bootstrap Practical Project Rough Work"
author: "M Meyer (22675760)"
date: "2024-05-05"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(MASS)
library(ggplot2)
library(gridExtra)
library(kableExtra)
library(cluster)
library(combinat)
library(maps)
library(tidyr)

library(bootstrap)
library(bayesboot)
library(boot, lib.loc = "/Library/Frameworks/R.framework/Versions/4.2/Resources/library")

newset <- read.csv("newset.csv")
newset$Age <- factor(newset$Age)
newset$Gender <- factor(newset$Gender)
newset$Country <- factor(newset$Country)
newset$Region <- factor(newset$Region)

longset <- read.csv("longset.csv")
longset$Covid <- factor(longset$Covid)

```

# Age

Took out the `na` values. Note there are only `na` values for age, and not for any other variable.



```{r}
agedat <- na.omit(newset)

# get the different age categories
unique(agedat$Age)

less20 <- agedat[agedat$Age=="<20",]
int20_35 <- agedat[agedat$Age=="20-35",]
int35_50 <- agedat[agedat$Age=="35-50",]
plus50 <- agedat[agedat$Age=="50+",]

nsize <- nrow(agedat)
bsize <- nsize
B <- 500

ogsamp <- agedat # specify your sample (cont or discrete)

statvals <- matrix(0, nrow=B, ncol = 5)
colnames(statvals) <- c("AgeCat1", "AgeCat2", "AgeCat3", "AgeCat4", "OverallMean")

# perform normal bootstrap on them
for (b in 1:B)
{
  newSelect <- sample(1:nsize, size = bsize, replace = TRUE)
  newSample <- ogsamp[newSelect,]
  mean1 <- mean(newSample[newSample$Age=="<20","Total"])
  mean2 <- mean(newSample[newSample$Age=="20-35","Total"])
  mean3 <- mean(newSample[newSample$Age=="35-50","Total"])
  mean4 <- mean(newSample[newSample$Age=="50+","Total"])
  meanall <- mean(newSample[,"Total"])
  statvals[b,] <- c(mean1, mean2, mean3, mean4,meanall)
}

# Generating data
set.seed(123) # for reproducibility
statvals <- data.frame(statvals)
data <- gather(statvals[,1:4], key = "AgeCat", value = "MeanTotal")

ggplot(data, aes(x = MeanTotal, fill = AgeCat, after_stat(density))) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 35) +
  geom_density(aes(color = AgeCat), alpha = 0.5) + # Overlay density plot
  scale_fill_manual(values = c("AgeCat1" = "blue", "AgeCat2" = "magenta", "AgeCat3" = "turquoise", "AgeCat4" = "orange")) +
  scale_color_manual(values = c("AgeCat1" = "blue2", "AgeCat2" = "magenta2", "AgeCat3" = "turquoise2", "AgeCat4" = "orange2")) + # Match colors for density plots
  labs(title = "Histogram of Age Categories with Density Overlay",
       x = "Estimated Mean Total Score",
       y = "Density",
       fill = "Category",
       color = "Category") +
  theme_minimal()

# Plotting histograms with ggplot on a 2x2 grid
ggplot(data, aes(x = MeanTotal, fill = AgeCat, after_stat(density))) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 30) +
  geom_density(aes(color = AgeCat), alpha = 0.5) + # Overlay density plot
  facet_wrap(~ AgeCat, nrow = 2, ncol = 2) +
  scale_fill_manual(values = c("AgeCat1" = "blue", "AgeCat2" = "magenta", "AgeCat3" = "turquoise", "AgeCat4" = "orange")) +
  scale_color_manual(values = c("AgeCat1" = "blue3", "AgeCat2" = "magenta3", "AgeCat3" = "turquoise3", "AgeCat4" = "orange2")) + # Match colors for density plots
  labs(title = "Histogram of Age Categories with Density Overlay",
       x = "Estimated Mean Total Score",
       y = "Density",
       fill = "Category",
       color = "Category") +
  theme_minimal()
```


# Gender


```{r}
set.seed(12345)

FemSmell <- newset[newset$Gender=="Female",]
MaleSmell <- newset[newset$Gender=="Male",]
smellset <- rbind(FemSmell, MaleSmell)
nF <- nrow(FemSmell)
nM <- nrow(MaleSmell)

nsize <- nrow(smellset)
bsize <- nsize
B <- 1000

ogsamp <- smellset # specify your sample (cont or discrete)
ogmeanF <- mean(smellset[smellset$Gender=="Female","Smell"])
ogmeanM <- mean(smellset[smellset$Gender=="Male","Smell"])
ogmeandiff <- ogmeanF-ogmeanM
# -0.3436272

statvals <- matrix(0, nrow=B, ncol = 3)
colnames(statvals) <- c("Female", "Male", "MeanDiff")

# perform normal bootstrap on them
for (b in 1:B)
{
  newSelect <- sample(1:nsize, size = bsize, replace = TRUE)
  newSample <- ogsamp[newSelect,]
  meanF <- mean(newSample[newSample$Gender=="Female","Smell"])
  meanM <- mean(newSample[newSample$Gender=="Male","Smell"])
  meandiff <- meanF-meanM
  statvals[b,] <- c(meanF, meanM, meandiff)
}
statvals <- data.frame(statvals)

theta <- function(dat){ mean(dat[dat$Gender=="Female","Smell"]) - mean(dat[dat$Gender=="Male","Smell"]) }

thetastar <- statvals$MeanDiff
alpha = c(0.05, 0.95)
z0 <- qnorm(sum(statvals[,3]<ogmeandiff)/B)
u <- rep(0, nsize)
for (i in 1:nsize) {
    u[i] <- theta(newset[-i,])
}
uu <- mean(u) - u
acc <- sum(uu * uu * uu)/(6 * (sum(uu * uu))^1.5)

zalpha <- qnorm(alpha)

tt <- pnorm(z0 + (z0 + zalpha)/(1 - acc * (z0 + zalpha)))
confpoints <- quantile(x = thetastar, probs = tt, type = 1)
confpoints
```

Now visualise the data

```{r}
data <- gather(statvals[,1:2], key = "Gender", value = "MeanSmell")

ggplot(data, aes(x = MeanSmell, fill = Gender, after_stat(density))) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 35) +
  geom_density(aes(color = Gender), alpha = 0.5) + # Overlay density plot
  scale_fill_manual(values = c("Female" = "magenta","Male" = "cornflowerblue")) +
  scale_color_manual(values = c("Female" = "magenta3", "Male" = "blue")) + # Match colors for density plots
  labs(title = "Histogram of Smell by Gender with Density Overlay",
       x = "Estimated Mean Smell",
       y = "Density",
       fill = "Category",
       color = "Category") +
  theme_minimal()

# Plot histogram with confidence interval lines and annotations
confidence_interval <- confpoints

ggplot(data.frame(x = thetastar), aes(x = x)) +
  geom_histogram(binwidth = 0.05, fill = "skyblue", color = "black", alpha = 0.8) +
  geom_vline(xintercept = confidence_interval, linetype = "dashed", color = "maroon", size = 1) +
  geom_text(aes(x = confidence_interval[1] + 0.4, y = 100, label = paste("Lower:", round(confidence_interval[1], 2))),
            color = "maroon", vjust = 0, hjust = 0) +
  geom_text(aes(x = confidence_interval[2] - 0.4, y = 100, label = paste("Upper:", round(confidence_interval[2], 2))),
            color = "maroon", vjust = 0, hjust = 1) +
  labs(title = expression("Histogram of Difference in Means with BC"[a] ~ "Confidence Interval"), x = "Value", y = "Frequency") +
  theme_minimal() # You can change the theme if needed

```

Now we want to investigate the distributions of the two groups, as well as the impact of the two sample size...

```{r}
set.seed(12345)

nsize <- nrow(smellset)
bsize <- nsize
B <- 1000

s.pooled <- sqrt(((nF-1)*var(FemSmell$Smell) + (nM-1)*var(MaleSmell$Smell))/(nsize-2))
denom <- s.pooled*sqrt((1/nF) + (1/nM))
t.obs <- (mean(FemSmell$Smell)-mean(MaleSmell$Smell))/denom

t.star.st <- numeric(B)

# perform normal bootstrap on them
for (b in 1:B)
{
  newSelect <- sample(1:nsize, size = bsize, replace = TRUE)
  newSample <- smellset[newSelect,]
  new.f <- newSample[1:nF,]
  new.m <- newSample[(nF+1):nsize,]
  s.pooled <- sqrt(((nF-1)*var(new.f$Smell) + (nM-1)*var(new.m$Smell))/(nsize-2))
  denom <- s.pooled*sqrt((1/nF) + (1/nM))
  t.star.st[b] <- (mean(new.f$Smell)- mean(new.m$Smell))/denom
}

ASL.student <- sum(t.star.st >= t.obs)/B

resultsAll01 <- data.frame(Result = c("nF", "nM", "FemaleVariance", "MaleVariance", "t.obs", "ASL.student"),
                         Value = c(nF, nM, var(FemSmell$Smell), var(MaleSmell$Smell), t.obs, ASL.student))
resultsAll01

hist(t.star.st)
abline(v = t.obs, col = "maroon", lty = 2)
text(x=t.obs-0.3, y = 175, labels="t.obs", col = "maroon", cex = 0.8)
```

Now suppose they don't have equal variances... Use Algo 16.2.

```{r}
set.seed(12345)

nF <- nrow(FemSmell)
nM <- nrow(MaleSmell)

nsize <- nrow(smellset)
bsize <- nsize
B <- 1000

# Algorithm 16.2
x.bar <- mean(smellset$Smell)
denom <- sqrt((var(FemSmell$Smell)/nF) + (var(MaleSmell$Smell)/nM))
t.obs <- (mean(FemSmell$Smell)-mean(MaleSmell$Smell))/denom
f.trans <- FemSmell$Smell - mean(FemSmell$Smell) + x.bar
m.trans <- MaleSmell$Smell - mean(MaleSmell$Smell) + x.bar

t.star.H02 <- numeric(B)

for (b in 1:B)
{
  new.f <- f.trans[sample(1:nF, size = bsize, replace = TRUE)]
  new.m <- m.trans[sample(1:nM, size = bsize, replace = TRUE)]
  denom <- sqrt((var(new.f)/nF) + (var(new.m)/nM))
  t.star.H02[b] <- (mean(new.f)-mean(new.m))/denom
}

ASL.H02 <- sum(t.star.H02 >= t.obs)/B
ASL.H02
resultsAll02 <- data.frame(Result = c("nF", "nM", "FemaleVariance", "MaleVariance", "t.obs", "ASL.H02"),
                         Value = c(nF, nM, var(FemSmell$Smell), var(MaleSmell$Smell), t.obs, ASL.H02))
resultsAll02

hist(t.star.H02, xlim = c(-3, 3))
abline(v = t.obs, col = "maroon", lty = 2)
text(x=t.obs+0.5, y = 175, labels="t.obs", col = "maroon", cex = 0.8)
```


### Test for gender difference among youth

Now investigate the differences when looking at specific age categories. Use Algorithm 16.2 with unequal variances to test for **ages less than 20 years (youth)**. Note how the sample sizes are closer together now.

```{r}
set.seed(12345)

FemSmellYouth <- na.omit(newset[newset$Gender=="Female" & newset$Age=="<20",])
MaleSmellYouth <- na.omit(newset[newset$Gender=="Male" & newset$Age=="<20",])
smellsetYouth <- rbind(FemSmellYouth, MaleSmellYouth)

nF <- nrow(FemSmellYouth)
nM <- nrow(MaleSmellYouth)

nsize <- nrow(smellsetYouth)
bsize <- nsize
B <- 1000

# Algorithm 16.2
x.bar <- mean(smellsetYouth$Smell)
denom <- sqrt((var(FemSmellYouth$Smell)/nF) + (var(MaleSmellYouth$Smell)/nM))
t.obs <- (mean(FemSmellYouth$Smell)-mean(MaleSmellYouth$Smell))/denom
f.trans <- FemSmellYouth$Smell - mean(FemSmellYouth$Smell) + x.bar
m.trans <- MaleSmellYouth$Smell - mean(MaleSmellYouth$Smell) + x.bar

t.star.H02 <- numeric(B)

for (b in 1:B)
{
  new.f <- f.trans[sample(1:nF, size = bsize, replace = TRUE)]
  new.m <- m.trans[sample(1:nM, size = bsize, replace = TRUE)]
  denom <- sqrt((var(new.f)/nF) + (var(new.m)/nM))
  t.star.H02[b] <- (mean(new.f)-mean(new.m))/denom
}

ASL.H02 <- sum(t.star.H02 >= t.obs)/B
resultsYouth <- data.frame(Result = c("nF", "nM", "FemaleVariance", "MaleVariance", "t.obs", "ASL.H02"),
                         Value = c(nF, nM, var(FemSmellYouth$Smell), var(MaleSmellYouth$Smell), t.obs, ASL.H02))
resultsYouth

hist(t.star.H02)
abline(v = t.obs, col = "maroon", lty = 2)
text(x=t.obs+0.3, y = 175, labels="t.obs", col = "maroon", cex = 0.8)
```

### Test for gender difference among ages 20-35

Now investigate the differences when looking at specific age categories. Use Algorithm 16.2 with unequal variances to test for **ages between 20 and 35**. From this result we can see that the difference at medium ages are not too different. But note here that the sample size now differ more than at the younger ages.

```{r}
set.seed(12345)

FemSmellMed <- na.omit(newset[newset$Gender=="Female" & newset$Age=="20-35",])
MaleSmellMed <- na.omit(newset[newset$Gender=="Male" & newset$Age=="20-35",])
smellsetMed <- rbind(FemSmellMed, MaleSmellMed)

nF <- nrow(FemSmellMed)
nM <- nrow(MaleSmellMed)

nsize <- nrow(smellsetMed)
bsize <- nsize
B <- 1000

# Algorithm 16.2
x.bar <- mean(smellsetMed$Smell)
denom <- sqrt((var(FemSmellMed$Smell)/nF) + (var(MaleSmellMed$Smell)/nM))
t.obs <- (mean(FemSmellMed$Smell)-mean(MaleSmellMed$Smell))/denom
f.trans <- FemSmellMed$Smell - mean(FemSmellMed$Smell) + x.bar
m.trans <- MaleSmellMed$Smell - mean(MaleSmellMed$Smell) + x.bar

t.star.H02 <- numeric(B)

for (b in 1:B)
{
  new.f <- f.trans[sample(1:nF, size = bsize, replace = TRUE)]
  new.m <- m.trans[sample(1:nM, size = bsize, replace = TRUE)]
  denom <- sqrt((var(new.f)/nF) + (var(new.m)/nM))
  t.star.H02[b] <- (mean(new.f)-mean(new.m))/denom
}

ASL.H02 <- sum(t.star.H02 >= t.obs)/B

resultsMed <- data.frame(Result = c("nF", "nM", "FemaleVariance", "MaleVariance", "t.obs", "ASL.H02"),
                         Value = c(nF, nM, var(FemSmellMed$Smell), var(MaleSmellMed$Smell), t.obs, ASL.H02))
resultsMed

hist(t.star.H02, ylim = c(0, 330))
abline(v = t.obs, col = "maroon", lty = 2)
text(x=t.obs+0.18, y = 315, labels="t.obs", col = "maroon", cex = 0.8)
```

### Test for gender difference among ages 35-50

Now investigate the differences when looking at specific age categories. Use Algorithm 16.2 with unequal variances to test for **ages between 20 and 35**. From this result we can see that the difference at medium ages are not too different. But note here that the sample size now differ more than at the younger ages.

```{r}
set.seed(12345)

FemSmellMed2 <- na.omit(newset[newset$Gender=="Female" & newset$Age=="35-50",])
MaleSmellMed2 <- na.omit(newset[newset$Gender=="Male" & newset$Age=="35-50",])
smellsetMed2 <- rbind(FemSmellMed2, MaleSmellMed2)

nF <- nrow(FemSmellMed2)
nM <- nrow(MaleSmellMed2)

nsize <- nrow(smellsetMed2)
bsize <- nsize
B <- 1000

# Algorithm 16.2
x.bar <- mean(smellsetMed2$Smell)
denom <- sqrt((var(FemSmellMed2$Smell)/nF) + (var(MaleSmellMed2$Smell)/nM))
t.obs <- (mean(FemSmellMed2$Smell)-mean(MaleSmellMed2$Smell))/denom
f.trans <- FemSmellMed2$Smell - mean(FemSmellMed2$Smell) + x.bar
m.trans <- MaleSmellMed2$Smell - mean(MaleSmellMed2$Smell) + x.bar

t.star.H02 <- numeric(B)

for (b in 1:B)
{
  new.f <- f.trans[sample(1:nF, size = bsize, replace = TRUE)]
  new.m <- m.trans[sample(1:nM, size = bsize, replace = TRUE)]
  denom <- sqrt((var(new.f)/nF) + (var(new.m)/nM))
  t.star.H02[b] <- (mean(new.f)-mean(new.m))/denom
}

ASL.H02 <- sum(t.star.H02 >= t.obs)/B

resultsMed <- data.frame(Result = c("nF", "nM", "FemaleVariance", "MaleVariance", "t.obs", "ASL.H02"),
                         Value = c(nF, nM, var(FemSmellMed2$Smell), var(MaleSmellMed2$Smell), t.obs, ASL.H02))
resultsMed

hist(t.star.H02, ylim = c(0, 330))
abline(v = t.obs, col = "maroon", lty = 2)
text(x=t.obs+0.18, y = 315, labels="t.obs", col = "maroon", cex = 0.8)
```

# Culture

Just start by plotting the histograms and densities.

```{r}

# calculate the number of countries in every region
regions <- unique(newset$Region)
regioncount <- matrix(0, ncol =2, nrow = (length(regions)))
row.names(regioncount) <- regions
colnames(regioncount) <- c("NrCountries", "NrEntries")

for (i in 1:(length(unique(newset$Region))))
{
  regiondat <- newset[newset$Region==regions[i],]
  regioncount[i,1] <- length(unique(regiondat$Country))
  regioncount[i,2] <- length(regiondat$Country)
}
regioncount


# calculate the number of countries in every region
countries <- unique(newset$Country)
countrycount <- matrix(0, ncol =1, nrow = (length(countries)))
row.names(countrycount) <- countries
colnames(countrycount) <- c("NrEntries")

for (i in 1:(length(unique(newset$Country))))
{
  countrydat <- newset[newset$Country==countries[i],]
  countrycount[i,1] <- nrow(countrydat)
}
countrycount

# Make histograms for the different regions

sa <- newset[newset$Region=="southAfrica",]
na <- newset[newset$Region=="northAmerica",]
uk <- newset[newset$Region=="UKireland",]
aus <- newset[newset$Region=="AustrNZ",]
other <- newset[newset$Region=="Other",]
afr <- newset[newset$Region=="Africa",]

# Do bootstrap for mean total threshold

nsize <- nrow(newset)
bsize <- nsize
B <- 500

ogsamp <- newset # specify your sample (cont or discrete)

statvals <- matrix(0, nrow=B, ncol = 7)
colnames(statvals) <- c("sa", "namerica", "uk", "aus", "other", "africa", "all")

# perform normal bootstrap on them
for (b in 1:B)
{
  newSelect <- sample(1:nsize, size = bsize, replace = TRUE)
  newSample <- ogsamp[newSelect,]
  mean1 <- mean(newSample[newSample$Region=="southAfrica","Total"])
  mean2 <- mean(newSample[newSample$Region=="northAmerica","Total"])
  mean3 <- mean(newSample[newSample$Region=="UKireland","Total"])
  mean4 <- mean(newSample[newSample$Region=="AustrNZ","Total"])
  mean5 <- mean(newSample[newSample$Region=="Other","Total"])
  mean6 <- mean(newSample[newSample$Region=="Africa","Total"])
  
  meanall <- mean(newSample[,"Total"])
  statvals[b,] <- c(mean1, mean2, mean3, mean4, mean5, mean6 ,meanall)
}

# Generating data
set.seed(123) # for reproducibility
statvals <- data.frame(statvals)
data <- gather(statvals[,c(1:4,6)], key = "Region", value = "MeanTotal")

ggplot(data, aes(x = MeanTotal, fill = Region, after_stat(density))) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 35) +
  geom_density(aes(color = Region), alpha = 0.5) + # Overlay density plot
  scale_fill_manual(values = c("sa" = "blue", "namerica" = "magenta", "uk" = "turquoise", "aus" = "orange", "africa" = "green")) +
  scale_color_manual(values = c("sa" = "blue2", "namerica" = "magenta2", "uk" = "turquoise3", "aus" = "orange2", "africa" = "green2")) + # Match colors for density plots
  labs(title = "Histogram of Regions with Density Overlay",
       x = "Estimated Mean Total Score",
       y = "Density",
       fill = "Region",
       color = "Region") +
  theme_minimal()

# Plotting histograms with ggplot on a 2x2 grid
ggplot(data, aes(x = MeanTotal, fill = Region, after_stat(density))) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 30) +
  geom_density(aes(color = Region), alpha = 0.5) + # Overlay density plot
  facet_wrap(~ Region, nrow = 2, ncol = 3) +
  scale_fill_manual(values = c("sa" = "blue", "namerica" = "magenta", "uk" = "turquoise", "aus" = "orange", "other" = "yellow2", "africa" = "green")) +
  scale_color_manual(values = c("sa" = "blue2", "namerica" = "magenta2", "uk" = "turquoise3", "aus" = "orange2", "other" = "yellow3", "africa" = "green2")) + # Match colors for density plots
  labs(title = "Histogram of Regions with Density Overlay",
       x = "Estimated Mean Total Score",
       y = "Density",
       fill = "Region",
       color = "Region") +
  theme_minimal()
```

### Test whether different senses have very different thresholds (1) overall and (2) in foundational years aka <20

You can see here that North America has lots of variation between the different senses and shows that outof all the regions, the individuals don't develop their sensory sensitivity evenly.

```{r}
# Test over all ages
statvals <- matrix(0, nrow=B, ncol = 5)
colnames(statvals) <- c("sa", "namerica", "uk", "aus", "africa")

# perform normal bootstrap on them
for (b in 1:B)
{
  newSelect <- sample(1:nsize, size = bsize, replace = TRUE)
  newSample <- ogsamp[newSelect,]
  var(apply(newset[,3:8],2,mean))
  var(apply(newSample[newSample$Region=="southAfrica", 3:8], 2, mean))
  var1 <- var(apply(newSample[newSample$Region=="southAfrica", 3:8], 2, mean))
  var2 <- var(apply(newSample[newSample$Region=="northAmerica", 3:8], 2, mean))
  var3 <- var(apply(newSample[newSample$Region=="UKireland", 3:8], 2, mean))
  var4 <- var(apply(newSample[newSample$Region=="AustrNZ", 3:8], 2, mean))
  # var5 <- var(apply(newSample[newSample$Region=="Other", 3:8], 2, mean))
  var6 <- var(apply(newSample[newSample$Region=="Africa", 3:8], 2, mean))
  
  meanall <- mean(newSample[,"Total"])
  statvals[b,] <- c(var1, var2, var3, var4, var6)
}

statvals <- data.frame(statvals)
data <- gather(statvals, key = "Region", value = "MeanVar")

ggplot(data, aes(x = MeanVar, fill = Region, after_stat(density))) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 30) +
  geom_density(aes(color = Region), alpha = 0.5) + # Overlay density plot
  scale_fill_manual(values = c("sa" = "blue", "namerica" = "magenta", "uk" = "turquoise", "aus" = "orange", "other" = "yellow2","africa" = "green")) +
  scale_color_manual(values = c("sa" = "blue2", "namerica" = "magenta2", "uk" = "turquoise3", "aus" = "orange2", "other" = "yellow3", "africa" = "green2")) + # Match colors for density plots
  labs(title = "Histogram of Regions with Density Overlay",
       x = "Estimated Variance between scores",
       y = "Frequency",
       fill = "Region",
       color = "Region") +
  theme_minimal()

```

Now we test for youth.

```{r}
youth <- agedat[agedat$Age=="<20",]

nsize <- nrow(youth)
bsize <- nsize
B <- 500

ogsamp <- youth # specify your sample (cont or discrete)

# Test over all ages
statvals <- matrix(0, nrow=B, ncol = 3)
colnames(statvals) <- c("sa", "uk", "aus")

# perform normal bootstrap on them
for (b in 1:B)
{
  newSelect <- sample(1:nsize, size = bsize, replace = TRUE)
  newSample <- ogsamp[newSelect,]
  var1 <- var(apply(newSample[newSample$Region=="southAfrica", 3:8], 2, mean))
  # var2 <- var(apply(newSample[newSample$Region=="northAmerica", 3:8], 2, mean))
  var3 <- var(apply(newSample[newSample$Region=="UKireland", 3:8], 2, mean))
  var4 <- var(apply(newSample[newSample$Region=="AustrNZ", 3:8], 2, mean))
  # var5 <- var(apply(newSample[newSample$Region=="Other", 3:8], 2, mean))
  # var6 <- var(apply(newSample[newSample$Region=="Africa", 3:8], 2, mean))
  
  meanall <- mean(newSample[,"Total"])
  statvals[b,] <- c(var1, var3, var4)
}

statvals <- data.frame(statvals)
data <- gather(statvals, key = "Region", value = "MeanVar")

ggplot(data, aes(x = MeanVar, fill = Region, after_stat(density))) +
  geom_histogram(position = "identity", alpha = 0.5, bins = 40) +
  geom_density(aes(color = Region), alpha = 0.5) + # Overlay density plot
  scale_fill_manual(values = c("sa" = "blue", "namerica" = "magenta", "uk" = "turquoise", "aus" = "orange", "other" = "yellow2","africa" = "green")) +
  scale_color_manual(values = c("sa" = "blue2", "namerica" = "magenta3", "uk" = "turquoise3", "aus" = "orange2", "other" = "yellow3", "africa" = "green2")) + # Match colors for density plots
  labs(title = "Histogram of Regions with Density Overlay",
       x = "Estimated Variance between scores",
       y = "Frequency",
       fill = "Region",
       color = "Region") +
  theme_minimal()

```

Maybe do this using bootstrap as well?...

```{r}

sa <- newset[newset$Region=="southAfrica",]
na <- newset[newset$Region=="northAmerica",]
uk <- newset[newset$Region=="UKireland",]
aus <- newset[newset$Region=="AustrNZ",]
other <- newset[newset$Region=="Other",]
afr <- newset[newset$Region=="Africa",]

senses<- rbind(apply(sa[, 3:8], 2, mean),
               apply(na[, 3:8], 2, mean),
               apply(uk[, 3:8], 2, mean),
               apply(aus[, 3:8], 2, mean),
               apply(other[, 3:8], 2, mean),
               apply(afr[, 3:8], 2, mean))
x <- 1:6

cols <- c("blue", "magenta", "turquoise", "orange", "yellow2", "green")

plot(x = x, y = senses[1,], xaxt = 'n',pch = 16, col = "blue", type = "n",
     ylim = c(-4, 1.5), ylab = "Mean total subscale score", main = "Comparing subscores over different regions")
axis(1, at = 1:6, labels = colnames(senses))
rect(par("usr")[1], -2, par("usr")[2], 2, col = "lightcyan", border = NA,density = 30)
rect(par("usr")[1], -3, par("usr")[2], -2, col = "antiquewhite", border = NA,density = 30)
rect(par("usr")[1], -10, par("usr")[2], -3, col = "peachpuff2", border = NA,density = 30)
for (i in 1:6) {
  points(x=x, y = senses[i,], pch = 16, col = cols[i])
  lines(x=x, y = senses[i,], col = cols[i])
}
abline(h = 0, col = "grey", lty = 3)
abline(h = -2, col = "lightgrey", lty = 3)
abline(h = -3, col = "lightgrey", lty = 3)
legend("bottomright", legend = c("sa", "namerica", "uk", "aus", "other","africa"), 
       col = c("blue", "magenta", "turquoise", "orange", "yellow2", "green"), 
       cex = 0.7,lty = 1, pch = 16, bg = "white",box.col= "white", y.intersp = 0.8)


```



var(apply(newset[,3:8],2,mean))
# Covid-19
